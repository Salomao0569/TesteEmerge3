function gerarPDF() {
    const { jsPDF } = window.jspdf;
    const doc = new jsPDF({
        orientation: 'portrait',
        unit: 'mm',
        format: 'a4'
    });

    const pageWidth = doc.internal.pageSize.width;
    const margin = 20;

    // Identificação
    doc.autoTable({
        head: [['Identificação']],
        body: [
            ['Nome:', document.getElementById('nome').value, 'Sexo', document.getElementById('sexo').value],
            ['Data de Nascimento', document.getElementById('dataNascimento').value, 'Data', document.getElementById('idade').value],
            ['Peso:', document.getElementById('peso').value],
            ['Altura', document.getElementById('altura').value, 'Superfície Corporea:', document.getElementById('superficie').value]
        ],
        startY: margin,
        theme: 'grid',
        styles: {
            fontSize: 10,
            cellPadding: 2,
            lineWidth: 0.1,
            lineColor: [0, 0, 0],
            minCellHeight: 6
        },
        headStyles: {
            halign: 'center',
            fillColor: false,
            textColor: [0, 0, 0],
            fontStyle: 'bold'
        },
        margin: { left: margin, right: margin }
    });

    // Cálculos e Medidas
    doc.autoTable({
        head: [['Cálculos e Medidas']],
        body: [
            ['Aorta', '31', 'mm', 'Volume Diastólico Final', '154', 'ml'],
            ['Aorta Ascendente', '42', 'mm', 'Volume Sistólico', '67', 'ml'],
            ['Átrio Esquerdo', '31', 'mm', 'Massa do VE', '147', 'g'],
            ['Vol Atrial Esq. Indexado', '', '', 'Volume Ejetado', '87', 'ml'],
            ['Diametro Diastólico', '48', 'mm', 'Fração de Ejeção', '57', '%'],
            ['Diametro Sistólico', '32', 'mm', 'Percentual Enc. Cavidade', '33', '%'],
            ['Espessura do Septo', '9', 'mm', 'Espessura Relativa Parede', '0,38', ''],
            ['Espessura da Parede', '9', 'mm', 'Índice de massa', '74', 'g/m2']
        ],
        startY: doc.autoTable.previous.finalY + 5,
        theme: 'grid',
        styles: {
            fontSize: 10,
            cellPadding: 2,
            lineWidth: 0.1,
            lineColor: [0, 0, 0],
            minCellHeight: 6
        },
        columnStyles: {
            1: { halign: 'center' },
            2: { halign: 'center' },
            4: { halign: 'center' },
            5: { halign: 'center' }
        },
        headStyles: {
            halign: 'center',
            fillColor: false,
            textColor: [0, 0, 0],
            fontStyle: 'bold'
        },
        margin: { left: margin, right: margin }
    });

    // Laudo - cada linha como uma tabela separada para manter o grid
    const laudoLines = [
        'Exame Realizado com ritmo cardíaco regular',
        '',
        'Cavidades Cardíacas com dimensões normais',
        'Raiz da Aorta com diâmetro Conservado',
        'Espessura miocádica do ventrículo esquerdo conservada',
        '',
        'Desempenho sistólico biventricular conservado. Não foram observadas alterações segmentares da',
        'Contratilidade ventricular',
        'Função Diastólica do ventrículo esquerdo conservado ao Doppler Mitral espectral',
        '',
        'Valva mitral com abertura e mobilidade conservadas. Colordoppler registrou refluxo discreto',
        'Valva tricúspide com abertura conservada.',
        'Valva aórtica com abertura e mobilidade conservadas.',
        'Valva pulmonar com abertura e mobilidade conservadas.',
        '',
        'Demais fluxos transvalvares com velocidades normais ao colordoppler',
        'Pericárdio ecograficamente normal.',
        '',
        'OPINIÃO:',
        'Ecocardiograma compatível com a normalidade'
    ];

    laudoLines.forEach((line, index) => {
        doc.autoTable({
            body: [[line]],
            startY: doc.autoTable.previous.finalY + (index === 0 ? 5 : 0),
            theme: 'grid',
            styles: {
                fontSize: 10,
                cellPadding: 2,
                lineWidth: 0.1,
                lineColor: [0, 0, 0],
                minCellHeight: 6
            },
            margin: { left: margin, right: margin }
        });
    });

    doc.save("laudo_ecocardiograma.pdf");
}