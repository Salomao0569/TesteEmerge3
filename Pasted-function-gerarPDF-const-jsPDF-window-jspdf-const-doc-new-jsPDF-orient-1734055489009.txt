function gerarPDF() {
    const { jsPDF } = window.jspdf;
    const doc = new jsPDF({
        orientation: 'portrait',
        unit: 'mm',
        format: 'a4'
    });

    const pageWidth = doc.internal.pageSize.width;
    const margin = 20;

    // Título
    doc.autoTable({
        head: [['Identificação']],
        body: [[
            {
                content: 
                `Nome: ${document.getElementById('nome').value}     Sexo: ${document.getElementById('sexo').value}
                Data de Nascimento: ${document.getElementById('dataNascimento').value}     Idade: ${document.getElementById('idade').value}
                Peso: ${document.getElementById('peso').value}     Altura: ${document.getElementById('altura').value}     Superfície Corpórea: ${document.getElementById('superficie').value}`,
                styles: { cellWidth: 'wrap' }
            }
        ]],
        startY: margin,
        theme: 'plain',
        styles: {
            fontSize: 9,
            cellPadding: 2,
        },
        headStyles: {
            halign: 'center',
            fontSize: 9,
            fontStyle: 'bold'
        },
        margin: { left: margin, right: margin }
    });

    // Cálculos e Medidas
    doc.autoTable({
        head: [['Cálculos e Medidas']],
        body: [
            ['Aorta', '31', 'mm', 'Volume Diastólico Final', '154', 'ml'],
            ['Aorta Ascendente', '42', 'mm', 'Volume Sistólico', '67', 'ml'],
            ['Átrio Esquerdo', '31', 'mm', 'Massa do VE', '147', 'g'],
            ['Vol Atrial Esq. Indexado', '', 'mm', 'Volume Ejetado', '87', 'ml'],
            ['Diâmetro Diastólico', '48', 'mm', 'Fração de Ejeção', '57', '%'],
            ['Diâmetro Sistólico', '32', 'mm', 'Percentual Enc. Cavidade', '33', '%'],
            ['Espessura do Septo', '9', 'mm', 'Espessura Relativa Parede', '0.38', ''],
            ['Espessura da Parede', '9', 'mm', 'Índice de massa', '74', 'g/m²']
        ],
        startY: doc.autoTable.previous.finalY + 5,
        theme: 'plain',
        styles: {
            fontSize: 8,
            cellPadding: 1,
            lineColor: [0, 0, 0],
            lineWidth: 0.1
        },
        columnStyles: {
            0: { cellWidth: 35 },
            1: { cellWidth: 10, halign: 'center' },
            2: { cellWidth: 10, halign: 'center' },
            3: { cellWidth: 35 },
            4: { cellWidth: 10, halign: 'center' },
            5: { cellWidth: 10, halign: 'center' }
        },
        headStyles: {
            halign: 'center',
            fontSize: 9,
            fontStyle: 'bold'
        },
        margin: { left: margin, right: margin }
    });

    // Texto do Laudo
    const laudoText = `
Exame Realizado com ritmo cardíaco regular.

Cavidades Cardíacas com dimensões normais
Raiz da Aorta com diâmetro Conservado
Espessura miocárdica do ventrículo esquerdo conservada

Desempenho sistólico biventricular conservado. Não foram observadas alterações segmentares da
contratilidade ventricular.
Função Diastólica do ventrículo esquerdo conservada ao Doppler Mitral espectral.

Valva mitral com abertura e mobilidade conservadas. Colordoppler registrou refluxo discreto.
Valva tricúspide com abertura conservada.
Valva aórtica com abertura e mobilidade conservadas.
Valva pulmonar com abertura e mobilidade conservadas.

Demais fluxos transvalvares com velocidades normais ao colordoppler
Pericárdio ecograficamente normal.

OPINIÃO:
Ecocardiograma compatível com a normalidade`;

    doc.setFontSize(9);
    const textLines = doc.splitTextToSize(laudoText, pageWidth - 2 * margin);
    doc.text(textLines, margin, doc.autoTable.previous.finalY + 10);

    // Numeração de página
    doc.setFontSize(8);
    doc.text('Página 1 de 1', pageWidth - margin, doc.internal.pageSize.height - 10, { align: 'right' });

    doc.save("laudo_ecocardiograma.pdf");
}